# This is a basic workflow to help you get started with Actions

name: SGSI_Build

on:
  watch:
    types: [started]
    
env:              
  ROM_URL: https://doc-10-6c-docs.googleusercontent.com/docs/securesc/tht8sr6cg7ads4qaqbj1v02jmasjllvv/965th97734rm834hm2ep313up5dsaf9v/1663824750000/05339394529291309094/05339394529291309094/1xEZXq_9RYlpysfns_qWsVZjaz6H9i3FG?e=download&ax=ALW9-sAB7NKuXFMnKICcocdVWy3K3ZZXYWvV9Y3hlvFk7QGPTgXrQPpjwzv8h1vQ3-dOlYMFqRFJ52s7sDLvEEEKMDz1E7x4oiFz3r-QK7fKFo_oavDkI4Tz0PVufKf_22fSjH2D4bkTwTXBOyi2ZZRt0tnUL8ckdirqyovO6fedeQGW0eG9sPyeZgJhAbYf69GBstiliHaq7rX6QyVLr_DcCctbM9vc-DniyQO8MV0m3IUKwDggLtdTgCvpee0G6LcU9PhY2WhWsj_grZ6jf8sIHXGzoB9EuMsTlqguFd5cwMWKzqVw4jiSch_7lxDBz2axR8OBtEmiL582YCykjvO2ZYuepcHMpW7AeCFScjK2r7CXwEvZmektYwXFiuTjspnt3hq7ZZWL9okpn3VWpnMfEkw94JiGi3DkWR0F7Scsl4JVWIETNlPCjW8FeevgxcARpBEYudPtUdmIU7d-DPuSvnDQKYXrEzHjHMbTuj5DyfUP4XeDBXUfP-Uz4ja7_ES9JCkJUQQ8alejoQFtNkyjcQINXiozBmd_bw6Hyq9ZGLNd2UyFEUDgewBGoxrxDbSL0wHgz5c56lQ4jH9p7nVIJvstDL2Za0-g7SEwM16KLoRuL-Bt-iBnF0qNikiF7FXotFfbRxLY57M7EsRa9kliX_ycE7tvZUbN4qzOQ1IgChx8QmjJB2cCebjhvJRUlwbaheXrUgIMmRgGIm01pRLz_dPolpfLt8YlkyVLe4NhEl3XOmp5PZwVd3lvwy-Z4of8Vpb4yv1G4XLzjyz3vyo...
  ZIP_NAME: XT1980-3_FOLES_AMZ_10_QPFS30.130-15-11-19_subsidy-DEFAULT_regulatory-DEFAULT_CFC.xml.zip
  OS_TYPE: Generic
  BUILD_TYPE: 'ab'
  REPACK_NAME: test_action.zip
  VERSION: 10
  upload_WeTransfer: 'true'
  upload_action-gh-release: 'false'
  SETUP: 'true'
  
jobs:
  build:
    runs-on: ubuntu-latest


    steps:
       - name: Checkout
         uses: actions/checkout@main
       
           
       - name: Setting up the SPICES
         run: |
            sudo apt-get install -y git openjdk-8-jdk wget git zip unzip curl
       - name: Cloning...
         run: |
             git clone https://github.com/xiaoxindada/SGSI-build-tool.git -b 12 $GITHUB_WORKSPACE/SGSI-build-tool
           
       - name: Download zip...
         run: |
            cd $GITHUB_WORKSPACE/SGSI-build-tool
            mkdir ./tmp
            cd ./tmp
            sudo wget $ROM_URL -O $ZIP_NAME && ls
            
       - name: Setup Tool Utils...
         if: env.SETUP == 'true'
         run: |
            sudo bash $GITHUB_WORKSPACE/SGSI-build-tool/setup.sh
       - name: Building AB DEVICES SGSI...
         if: env.BUILD_TYPE == 'AB' || env.BUILD_TYPE == 'ab'
         run: |
            sudo bash $GITHUB_WORKSPACE/SGSI-build-tool/make.sh --AB $OS_TYPE $ZIP_NAME --fix-bug
       - name: Building A-only DEVICES SGSI...
         if: env.BUILD_TYPE == 'a-only'
         run: |
            sudo bash $GITHUB_WORKSPACE/SGSI-build-tool/make.sh --a-only $OS_TYPE $ZIP_NAME --fix-bug            
       - name: Repack output file ...
         run: |            
             cd $GITHUB_WORKSPACE/SGSI-build-tool
             pwd
             zip -r $REPACK_NAME ./SGSI/*
             ls "$REPACK_NAME"
       - name: Upload SGSI to WeTransfer...
         if: env.upload_WeTransfer == 'true' 
         run: |
           cd $GITHUB_WORKSPACE/SGSI-build-tool
           pwd
           ls "$REPACK_NAME"
           curl -sL https://git.io/file-transfer | sh
           ./transfer wet ./$REPACK_NAME
       - name: Upload SGSI to action-gh-release...
         if: env.upload_action-gh-release == 'true'
         uses: softprops/action-gh-release@v1
         with:
           files: ${{ github.workspace }}/SGSI-build-tool/${{ env.REPACK_NAME }}
           name: xiaoxinSGSI-${{ env.OS_TYPE }}-${{ env.BUILD_TYPE }}-Android${{ env.VERSION }}-unpack
           tag_name: 12
           #body: Use actions auto bulid
         env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}       
